<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_window_crafting_barter</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-105</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Basic variables setup:
scroll=0;
selected=0;

xx=0;
yy=0;

//Combination list:
var i;

for (i=1; i&lt;=15; i+=1) begin
 comb_list[i]=0;
end;

update_list=true;
 
//Combination array:
var i;

for (i=1; i&lt;=16; i+=1) begin
 if i mod 2 = 1
   comb_array[i]=""
  else comb_array[i]=0;
end;

update_array=true;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>shop_write(shop_index);
shop_close();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Closing:
if keyboard_check_pressed(userControls[KEYBOARD.pause])=true
 instance_destroy();

//LIST: This will update the combination list if there was some scrolling or trading:
if update_list=true begin

 var i,counter,valid_counter;

 for (i=1; i&lt;=15; i+=1) begin
  comb_list[i]=0;
 end;

 counter=1;
 valid_counter=0;
 for (i=1; i&lt;=ds_list_size(global.barter_list); i+=1) begin

  //This condition will ensure that the shop only displays the offers it can make:
  if shop_count_item(-1,ds_list_find_value(global.barter_list[|i-1],0))
  &gt;= ds_list_find_value(global.barter_list[|i-1],1) { 
   
   valid_counter+=1;
   
   if valid_counter&gt;scroll {
    comb_list[counter]=ds_list_find_value(global.barter_list,i-1);
    counter+=1;
    }
   
   if counter&gt;15 break;
   
   }

 end;
 
 update_list=false;
 
 //Scroll correction:
 if comb_list[15]=0 {
  scroll-=1;
  
  for (i=1; i&lt;=15; i+=1) begin
   comb_list[i]=0;
  end;

  counter=1;
  valid_counter=0;
  for (i=1; i&lt;=ds_list_size(global.barter_list); i+=1) begin

   //This condition will ensure that the shop only displays the offers it can make:
   if shop_count_item(-1,ds_list_find_value(global.barter_list[|i-1],0))
   &gt;= ds_list_find_value(global.barter_list[|i-1],1) { 
   
    valid_counter+=1;
   
    if valid_counter&gt;scroll {
     comb_list[counter]=ds_list_find_value(global.barter_list,i-1);
     counter+=1;
     }
   
    if counter&gt;15 break;
   
    }

  end;
  
  }
 
 //This will un-select the currently selected offer if it's n olonger viable:
 check=false;
 for (i=1; i&lt;=15; i+=1) begin
  if comb_list[i]=selected {
   check=true;
   break;
   }
 end;
 if check=false {
  selected=0;
  update_array=true;
  }

end;

//ARRAY: This will get the required variables of the selected combination:
if update_array=true begin

 var i;

 //Flush the array:
 for (i=1; i&lt;=16; i+=1) begin
  if i mod 2 = 1
    comb_array[i]=""
   else comb_array[i]=0;
 end;

 //Fill the array:
 if selected&lt;&gt;0 begin

  for (i=1; i&lt;=ds_list_size(selected); i+=1) begin
  
   comb_array[i]=selected[| i-1];  
  
  end;

 end;
 
 update_array=false;
 
end;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="61">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if scroll&lt;ds_list_size(global.barter_list)-15 and comb_list[15]&lt;&gt;0 {
 scroll+=1;
 update_list=true;
 }
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="60">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if scroll&gt;0 {
 scroll-=1;
 update_list=true;
 }
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>var str,spr,i,counter,check;
//234,70
draw_set_font(f_windows);

//Set up GUI x and y:
xx=gui_width()/2-sprite_get_width(sprite_index)/2;
yy=gui_height()/2-sprite_get_height(sprite_index)/2;

//Draw own sprite:
draw_sprite(spr_window_crafting_barter,0,xx,yy);

//Draw header:
draw_sprite(spr_window_barter_header,0,xx,yy);

//COMBINATION LIST:
draw_set_alpha(1);
draw_set_valign(fa_top);
draw_set_halign(fa_left);

counter=0;

//LOOP BEGIN:
repeat (15) begin
counter+=1;

if comb_list[counter]&lt;&gt;0 {

//Small icons:
 spr=real( inv_item_get_static_value( ds_list_find_value(comb_list[counter],0),7));
 draw_sprite_ext(spr,0,xx+9,yy+counter*20+43,0.5,0.5,0,c_white,1); 

//Clickable text boxes:
spr=ite(comb_list[counter],selected,1,0);
if gui_draw_sprite_clickable(spr_window_name_box,spr,xx+29,yy+counter*20+43,1)=true
 {selected=comb_list[counter]; 
  update_array=true;}

//Combination names:
draw_set_color(c_black);
 draw_text(xx+32,yy+45+20*counter,ds_list_find_value(comb_list[counter],0)+" ("+string(ds_list_find_value(comb_list[counter],1))+")" );

} 
end;
//LOOP END;
 
//Filter title:
draw_set_color(c_black);
draw_text(xx+12,yy+42,"Offers:");

//COMBINATION DETAILS BEGIN:

if (selected&lt;&gt;0 and update_array=false) begin

//Item name:
draw_set_color(c_black); 
draw_text(xx+236,yy+40,comb_array[1]+" ("+string(comb_array[2])+")");

//Item icon:
draw_sprite(real(inv_item_get_static_value(comb_array[1],7)),0,xx+377,yy+67);

//Stock:
str="Merchant's#stock: "+string(shop_count_item(-1,comb_array[1]));
draw_text(xx+236,yy+70,str);

//Description:
str="You need:#";

i=3;
check=true; //It will also check whether it's currently possible to craft (in that case, "check" will be true).
repeat (7) begin
 if comb_array[i]&lt;&gt;"" {str+=" -"+comb_array[i]+" ("+string(inv_count_item(comb_array[i]))
                         +"/"+string(comb_array[i+1])+")#";
                         
 if inv_count_item(comb_array[i])&lt;comb_array[i+1] check=false; }

 i+=2;
end;

str+="#You will get:# -"+comb_array[1]+" ("+string(comb_array[2])+")"+":#  "+inv_item_get_static_value(comb_array[1],6);

draw_text_ext(xx+236,yy+113,str,13,180);

//Craft button:
spr=ite(check,true,0,1);
if gui_draw_sprite_clickable(spr_window_button_trade,spr,xx+249,yy+348,true)
 {if spr=0 { 
 i=3;
 repeat (7) begin
  if comb_array[i]&lt;&gt;"" {
   inv_remove_item(comb_array[i],comb_array[i+1]); 
   //shop_add_item(-1,comb_array[i],comb_array[i+1]);
   }
   i+=2;
 end;
 
 inv_add_item(comb_array[1],comb_array[2]);
 shop_remove_item(-1,comb_array[1],comb_array[2]);
 update_list=true;
 } }

end;


//COMBINATION DETAILS END;

//Scroll buttons:
if gui_draw_sprite_clickable(spr_window_button_scroll,0,xx+212,yy+63,true)=true
 {if scroll&gt;0 {scroll-=1; update_list=true;}}
if gui_draw_sprite_clickable(spr_window_button_scroll,1,xx+212,yy+343,true)=true
 {if scroll&lt;ds_list_size(global.barter_list)-15 {scroll+=1; update_list=true;}}

//Close button:
if gui_draw_sprite_clickable_rel(spr_window_close,0,xx+305,yy+370)
  instance_destroy();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//This is empty but needed.
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>0,0</point>
    <point>211,211</point>
  </PhysicsShapePoints>
</object>
